---
kind: pipeline
type: docker
name: default

platform:
  os: linux
  arch: amd64

steps:
- name: build docker
  image: plugins/docker
  settings:
    username:
      from_secret: hub_docker_username
    password:
      from_secret: hub_docker_password
    repo: idoge/stat_srv
    tags:
      - latest
      - '1.0'
    # ä¸  Dockerfile å¯¹åº”
    target: production

- name: notify-wx
  image: lizheming/drone-wechat
  pull: always
  settings:
    title: >
     {% if success %}
     âœ… {{repo.owner}}/{{repo.name}} ç¬¬ {{build.number}} æ¬¡æ„å»ºæˆåŠŸï¼
     {% else %}
     âŒ {{repo.owner}}/{{repo.name}} ç¬¬ {{build.number}} æ¬¡æ„å»ºå¤±è´¥äº†ï¼Œå¿«æ¥ä¿®ç†ä¸‹å§ã€‚
     {% endif %}
    corpid:
      from_secret: corpid
    corp_secret:
      from_secret: corp_secret
    agent_id:
      from_secret: agent_id
    to_user: "@all"
    message: >
      {% if success %}
      ğŸ˜Šä¸»äººï¼Œ{{repo.owner}}/{{repo.name}}ç¬¬{{build.number}}æ¬¡æ„å»ºæˆåŠŸï¼
      {% else %}
      ğŸ˜­ä¸»äººï¼Œ{{repo.owner}}/{{repo.name}}ç¬¬{{build.number}}æ¬¡æ„å»ºå¤±è´¥äº†ï¼Œå¿«æ¥ä¿®ç†ä¸‹å§ã€‚
      {% endif %}
  when:
    status:
    - success
    - failure

trigger:
  branch:
  - master


